"use strict";var h=Object.create;var c=Object.defineProperty;var l=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var v=Object.getPrototypeOf,w=Object.prototype.hasOwnProperty;var p=(t,o)=>{for(var s in o)c(t,s,{get:o[s],enumerable:!0})},g=(t,o,s,i)=>{if(o&&typeof o=="object"||typeof o=="function")for(let a of m(o))!w.call(t,a)&&a!==s&&c(t,a,{get:()=>o[a],enumerable:!(i=l(o,a))||i.enumerable});return t};var C=(t,o,s)=>(s=t!=null?h(v(t)):{},g(o||!t||!t.__esModule?c(s,"default",{value:t,enumerable:!0}):s,t)),I=t=>g(c({},"__esModule",{value:!0}),t);var $={};p($,{activate:()=>k,deactivate:()=>Q});module.exports=I($);var e=C(require("vscode")),n,r;function k(t){console.log("Antigravity Quota Watch is now active!");let o=e.commands.registerCommand("ag-quota.refresh",()=>{d(!0)});t.subscriptions.push(o),n=e.window.createStatusBarItem(e.StatusBarAlignment.Right,100),n.command="ag-quota.refresh",t.subscriptions.push(n),t.subscriptions.push(e.workspace.onDidChangeConfiguration(s=>{s.affectsConfiguration("antigravity")&&(e.window.showInformationMessage("Antigravity Quota Watch configuration changed. reloading..."),f())})),f()}function f(){r&&(clearInterval(r),r=void 0);let o=e.workspace.getConfiguration("antigravity").get("pollInterval",120);d(),r=setInterval(()=>d(),o*1e3)}function Q(){r&&clearInterval(r)}async function d(t=!1){let o=e.workspace.getConfiguration("antigravity"),s=o.get("endpoint","http://localhost:9222/v1/status"),i=o.get("lowQuotaThreshold",20);t&&(n.text="$(sync~spin) Checking Quota...",n.show());try{let a=await y(s),u=Math.round(a.quota*100);n.text=`$(dashboard) Quota: ${u}%`,n.tooltip=`Click to refresh.
Reset in: ${a.reset_in||"unknown"}`,u<i?n.backgroundColor=new e.ThemeColor("statusBarItem.errorBackground"):n.backgroundColor=void 0,t&&e.window.showInformationMessage(`Quota refreshed: ${u}% remaining.`),n.show()}catch(a){n.text="$(error) Quota: Offline",n.tooltip=`Error connecting to ${s}
${a.message}`,n.backgroundColor=new e.ThemeColor("statusBarItem.warningBackground"),n.show(),t&&e.window.showErrorMessage(`Failed to fetch quota: ${a.message}`)}}async function y(t){let o=await fetch(t);if(!o.ok)throw new Error(`HTTP ${o.status} ${o.statusText}`);return await o.json()}0&&(module.exports={activate,deactivate});
